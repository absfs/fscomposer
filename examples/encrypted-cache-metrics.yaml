version: "1.0"
name: "encrypted-cache-metrics"
description: "Encrypted filesystem with caching and metrics collection"

nodes:
  # Backend storage (local disk)
  - id: storage
    type: osfs
    config:
      root: /tmp/fscomposer-encrypted

  # Add encryption layer (AES-256-GCM)
  - id: encrypt
    type: encryptfs
    config:
      cipher: AES-256-GCM
      password: "test-password-change-in-production"
      kdfMemory: 65536  # 64MB
      kdfIterations: 3

  # Add caching layer for encrypted data
  - id: cache
    type: cachefs
    config:
      maxBytes: 10485760  # 10MB cache
      policy: LRU
      ttl: 300  # 5 minutes
      metadataCache: true

  # Add metrics collection
  - id: metrics
    type: metricsfs
    config:
      enablePrometheus: false

connections:
  - from: storage
    to: encrypt
  - from: encrypt
    to: cache
  - from: cache
    to: metrics

mount:
  type: fuse
  path: /mnt/encrypted-cache
  root: metrics
  options:
    allowOther: false
